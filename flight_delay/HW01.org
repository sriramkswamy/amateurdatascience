#+TITLE: Homework 1
#+AUTHOR: Sriram Krishnaswamy
#+DATE: 
#+OPTIONS: toc:nil

* Problem Statement

\noindent
Recently, at the start of summer, a few of us friends decided to meet up after a long time.
During the trip, I noticed that my flight got delayed in both the legs, just like it had
happened a lot of times before. When I brought this up, I found out that I wasn't the only
one facing this issue and that all my friends had experienced delays in flights constantly.

\noindent
I was intrigued by this phenomenon and decided to see for myself, using hard data, as to
exactly how many flights have been delayed in the first half of 2015. The data for this is
publicly available at [[http://transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time][data.gov]]
provided by the Bureau of Transport Statistics. To understand, the phenomenon a bit better, 
I asked myself a few questions.

- Is there a trend to the day of the week and the delays?
- How are the delays distributed?
- Is there a relation between departure delay and arrival delay?
- What is the probability that a flight will be delayed?

* Solution

\noindent
Before proceeding, it is important to note that the data used as a sample is only for the first
week of May. There is no way to know if the data is biased or not since there might have been a
non-trivial problem during in the first week of May, which although not very probable, might still
affect the data. Also, note that each snippet present in this document can be run individually
by evaluating the snippet provided along with it. The document itself was generated in a similar
fashion.

\noindent
The first step in understanding any sample is to plot the histogram of the same. We take the
departure delay data and plot the histogram shown in Figure [[hw01_dep_data_hist_fig]] which is
generated by the code in snippet [[hw01_hist_dep_data][1]].

#+NAME: hw01_dep_data_hist_fig
#+CAPTION: Histogram of Departure delays
[[./hw01_dep_data_hist.png]]

\noindent
There are 2 things that one can immediately notice here:

- There are some negative values --- These correspond to the early departures
- There aren't many delays after 120 minutes, or in other words, most of the cases have only
slight delays.

\noindent
Now, let us extract the data of only the flights that are delayed and plot a histogram of the
same to understand how that is distributed. The histogram for the same can be seen in Figure
[[hw01_dep_delay_hist_fig]] generated by snippet [[hw01_hist_dep_delay][2]]

#+NAME: hw01_dep_delay_hist_fig
#+CAPTION: Histogram of Departure delays
[[./hw01_dep_data_hist.png]]

\noindent
One can fathom a guess that this might similar to the Lognormal distribution and hence can be
compared with that. The comparison for both the delays and the overall data is provided in Figure
[[hw01_lognormal_probplot_ecdf_fig]] generated by the snippet [[hw01_lognormal_comparison][3]].
It can be seen that the guess was indeed right and it appears to be a lognormal distribution.
A similar procedure can be carried out for the arrival data as shown in
snippet [[hw01_arrival_everything][4]] and the Figure [[hw01_arrival_all_fig]] was generated.

#+NAME: hw01_lognormal_probplot_ecdf_fig
#+CAPTION: Comparison with Standard Lognormal Distribution
[[./hw01_lognormal_comparison.png]]

#+NAME: hw01_arrival_all_fig
#+CAPTION: Comparison with Standard Lognormal Distribution
[[./hw01_arrival_everything.png]]

\noindent
Next, when we try to understand which day of the week there are a lot of delays, we find that
it is prevalent for almost all the days of the week and shows no real distribution. The histogram
is shown in Figure [[hw01_week_data_hist]]

#+NAME: hw01_week_data_hist
#+CAPTION: Comparison with Standard Lognormal Distribution
[[./hw01_week_data.png]]

\noindent
Next, we need to identify if there is a correlation between the departure and the arrival.
Though, it is fairly logical that this has to be the case, the extent is still unknown. The
correlation plot is given in Figure [[hw01_dep_arr_correlation]]. From this, we see that if
there is a huge departure delay, there will be a huge arrival delay. However, when there are
only slight delays in departure, the trend is not so certain and we need to go deeper to understand.
However, this data also includes early departures. So, Figure [[hw01_dep_delay_arr_correlation_fig]]
shows the correlation between departure and arrival given that the flight starts late.

#+NAME: hw01_dep_arr_correlation
#+CAPTION: Correlation bertween departure and arrival delays
[[./hw01_dep_arrival_correlation_fig.png]]

#+NAME: hw01_dep_delay_arr_correlation_fig
#+CAPTION: Correlation bertween departure and arrival delays
[[./hw01_dep_delay_arrival_correlation_fig.png]]

\noindent
To know the extent of correlation, we need to identify the correlation coefficient given by

\begin{equation}
\rho_{XY} = \frac{\sigma_{XY}}{\sigma_{X} \sigma_{Y}}
\end{equation}

\noindent
We notice that if there is a delay in departure, there would be delay in the arrival, with
$\rho_{XY} = 1$

\noindent
Next, comes the important question of what is the probability that a flight is delayed.
It is easier to find out what is the probability of a flight getting delayed. For example,

\begin{equation}
P(delay > 120) = 1 - 0.9 = 0.1
\end{equation}

\noindent
The above equation tells us that the probability that a flight is delayed by more than 2 hours
is only 0.1. Similarly,

\begin{equation}
P(delay < 30 ) = 0.6
\end{equation}

\noindent
The above relation indicates there is a 60\% chance that the flight is delayed by around 30
minutes.

** Conclusion

\noindent
Based on the data collected in the first week of May 2015, we expect, on average, a flight has
60\% chance to be delayed by less than 30 minutes. Hopefully, this small study might be helpful
while choosing layover times and flight schedules.

* Code

** Departure data

#+NAME: hw01_hist_dep_data
#+begin_src matlab
load('./may_first_week.mat');
figure('visible','off')
hist(dep_data);
xlabel({'Delay','(in minutes)'})
print -dpng -r0 hw01_dep_data_hist.png;
#+end_src

#+RESULTS: hw01_hist_dep_data

** Departure delay

#+NAME: hw01_hist_dep_delay
#+begin_src matlab
load('./may_first_week.mat');
dep_delay = [];
dep_delay_count = 0;
for i = 1:size(dep_data)
    if (dep_data(i) > 0)
        dep_delay_count = dep_delay_count+1;
        dep_delay(dep_delay_count) = dep_data(i);
    end
end
figure('visible','off')
hist(dep_delay);
xlabel({'Delay','(in minutes)'})
print -dpng -r0 hw01_dep_delay_hist.png;
#+end_src

#+RESULTS: hw01_hist_dep_delay

** Lognormal comparison

#+NAME: hw01_lognormal_comparison
#+begin_src matlab
load('./may_first_week.mat');
dep_delay = [];
dep_delay_count = 0;
for i = 1:size(dep_data)
    if (dep_data(i) > 0)
        dep_delay_count = dep_delay_count+1;
        dep_delay(dep_delay_count) = dep_data(i);
    end
end
figure('visible','off')
subplot(2,2,1)
probplot('lognormal',dep_data);
xlabel({'Delay','(in minutes)'});
title('Departure data vs lognormal distribution');
subplot(2,2,2)
ecdf(dep_data)
xlabel({'Delay','(in minutes)'});
ylabel('Probability');
title('Experimental CDF of the departure');
subplot(2,2,3)
probplot('lognormal',dep_delay);
xlabel({'Delay','(in minutes)'});
title('Departure delay vs lognormal distribution');
subplot(2,2,4)
ecdf(dep_delay)
xlabel({'Delay','(in minutes)'});
ylabel('Probability');
title('Experimental CDF of the departure delays');
print -dpng hw01_lognormal_comparison.png
#+end_src

#+RESULTS: hw01_lognormal_comparison

** Arrival data and delay

#+NAME: hw01_arrival_everything
#+begin_src matlab
load('./may_first_week.mat');
arr_delay = [];
arr_delay_count = 0;
for i = 1:size(arr_data)
    if (arr_data(i) > 0)
        arr_delay_count = arr_delay_count+1;
        arr_delay(arr_delay_count) = arr_data(i);
    end
end
figure('visible','off')
subplot(3,2,1)
hist(arr_data);
title('Histogram of all the arrival data');
subplot(3,2,2)
hist(arr_delay);
title('Histogram of all the arrival delays');
subplot(3,2,3)
probplot('lognormal',arr_data);
xlabel({'Delay','(in minutes)'});
title('Arrival data vs lognormal distribution');
subplot(3,2,4)
ecdf(arr_data)
xlabel({'Delay','(in minutes)'});
ylabel('Probability');
title('Experimental CDF of the arrival');
subplot(3,2,5)
probplot('lognormal',arr_delay);
xlabel({'Delay','(in minutes)'});
title('Arrival delay vs lognormal distribution');
subplot(3,2,6)
ecdf(arr_delay)
xlabel({'Delay','(in minutes)'});
ylabel('Probability');
title('Experimental CDF of the arrival delays');
print -dpng hw01_arrival_everything.png
#+end_src

#+RESULTS: hw01_arrival_everything

** Week-wise data

#+NAME: hw01_week_data
#+begin_src matlab
load('./may_first_week.mat');
figure('visible','off')
hist(week_data);
xlabel({'Delay','(in minutes)'})
print -dpng -r0 hw01_week_data.png
#+end_src

#+RESULTS: hw01_week_data

** Correlation

#+NAME: hw01_correlation_data
#+begin_src matlab
load('./may_first_week.mat');
figure('visible','off')
plot(dep_data,arr_data);
xlabel('Departure data')
ylabel('Arrival data')
print -dpng -r0 hw01_dep_arrival_correlation_fig.png 
R = corrcoef(dep_data, arr_data);
ans = R;
#+end_src

#+RESULTS: hw01_correlation_data
| NaN | NaN |
| NaN | NaN |

** Correlation given the flight departs late

#+NAME: hw01_dep_delay_arr_correlation
#+begin_src matlab
load('./may_first_week.mat');
dep_delay = [];
dep_delay_count = 0;
dep_delay_index = [];
for i = 1:size(dep_data)
    if (dep_data(i) > 0)
        dep_delay_count = dep_delay_count+1;
        dep_delay(dep_delay_count) = dep_data(i);
        dep_delay_index(dep_delay_count) = i;
    end
end
arr_delay_given_dep_delay = [];
for j = 1:dep_delay_count
    arr_delay_given_dep_delay(j) = arr_data(dep_delay_index(j));
end
figure('visible','off')
plot(dep_delay,arr_delay_given_dep_delay);
xlabel('Departure data')
ylabel('Arrival data')
print -dpng -r0 hw01_dep_delay_arrival_correlation_fig.png 
R = corrcoef(dep_delay, arr_delay_given_dep_delay);
ans = R;
#+end_src

#+RESULTS: hw01_dep_delay_arr_correlation
|   1 | NaN |
| NaN | NaN |

